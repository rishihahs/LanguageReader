define(["jquery","read/wordreference","templates/spanish.template","jquery.popover","jstorage"],function(e,t,n){function o(r,s){t.getJSON(r,function(u){var a;if(u.hasOwnProperty("Error"))a="No translation found.";else{var f=u.term0.PrincipalTranslations[0].OriginalTerm.term;if(f!==r){o(f,s);return}var l=t.semantisizeJSON(u);a=n["spanish.hbs"](l),i.push(r),e.jStorage.set("words",i)}e(".popover-content").html(a),s.popover("rearrange")})}var r,i=e.jStorage.get("words",[]),s={placement:"auto",html:!0,title:'<span></span><i class="foundicon-speaker"></i>',content:"Loading...",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-canvas"><div class="popover-content"></div></div><button type="button" class="closepop closepop-popover">&times;</button></div>'};e("#content").on("click",".word",function(t){t.stopPropagation(),r&&(r.removeClass("active"),r.popover("destroy")),r=e(this),r.addClass("active");var n=this;r.popover(s),r.on("shown.bs.popover",function(){e(".closepop-popover:not(.bound)").addClass("bound").on("click",function(){e(n).popover("destroy"),r.removeClass("active")}),e("body").click(function(t){t.stopPropagation();var n=e(t.target).parents();if(n.hasClass("popover")||n.hasClass("top-bar"))return;r.popover("destroy"),r.removeClass("active")})}),r.popover("show");var i=e.trim(r.text().toLowerCase().replace(/[.?,"]/,""));e(".popover-title span").text(i),o(i,r)})});